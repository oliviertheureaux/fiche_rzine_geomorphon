library(rzine)
remotes::install_gitlab("rzine/package", host = "https://gitlab.huma-num.fr/", force = TRUE)
library(rzine)
install.packages("kableExtra")
install.packages("svglite")
R.Version()
devtools::install_github('r-lib/systemfonts')
# Packages
library(raster)
library(qgisprocess)
library(raster)
library(terra)
library(stars)
library(sf)
library(mapsf)
setwd("~/OT/GEO/GEO/MASTER/M2/SPATIAL_TREE_P/R/RZINE")
setwd("~/OT/GEO/GEO/MASTER/M2/SPATIAL_TREE_P/R/fiche_rzine_geomorphon")
# Sélection du BV via la GeoJSON ----
setwd("~/OT/GEO/GEO/MASTER/M2/SPATIAL_TREE_P/R/RZINE")
bv <- st_read("BassinVersantTopographique.json")
bv
library(dplyr)
bv <- bv %>% filter(bv$TopoOH == "Le Ribérot")
plot(bv)
bv <- bv %>% filter(bv$TopoOH == "La Séveraisse du torrent de Navette au Drac")
plot(bv)
bv <- st_read("BassinVersantTopographique.json")
bv <- bv %>% filter(bv$TopoOH == "La Séveraisse du torrent de Navette au Drac")
plot(bv)
bv <- st_read("BassinVersantTopographique.json")
bv <- bv %>% filter(bv$TopoOH == "La Tarentaine (Trentaine) de sa source au confluent de l'Eau Verte")
plot(bv)
bv <- st_read("BassinVersantTopographique.json")
riberot <- bv %>% filter(bv$TopoOH == "Le Ribérot")
severaisse <- bv %>% filter(bv$TopoOH == "La Séveraisse du torrent de Navette au Drac")
tarentaine <- bv %>% filter(bv$TopoOH == "La Tarentaine (Trentaine) de sa source au confluent de l'Eau Verte")
plot(severaisse)
# Création du raster virtuel Drac ----
setwd("C:/Users/thier/Downloads/mnt_63")
c <- "C:/Users/thier/Downloads/mnt_78_91"
v <- "C:/Users/thier/Downloads/new.vrt" # name of virtual raster
c <- "C:/Users/thier/Downloads/mnt_63"
v <- "C:/Users/thier/Downloads/new.vrt" # name of virtual raster
ras_lst <- list.files(c, full.names = T, pattern = ".asc$", recursive=T) # sélection de toutes les dalles
head(ras_lst)
terra::vrt(ras_lst, v, overwrite = T) # création du raster virtuel
ras <- read_stars(v)
st_crs(ras) = "EPSG:2154"
plot(ras, main = "dep 63")
mnt <- st_crop(ras,severaisse)
crs(ras)
st_crs(ras)
st_crs(severaisse)
st_crs(severaisse) = "EPSG:2154"
mnt <- st_crop(ras,severaisse)
plot(mnt)
st_transform(severaisse) = "EPSG:2154"
st_crs(severaisse) = "EPSG:2154"
st_transform(severaisse) = "EPSG:2154"
?st_transform
st_crs(severaisse, crs= "EPSG:2154")
severaisse <- bv %>% filter(bv$TopoOH == "La Séveraisse du torrent de Navette au Drac")
st_transform(severaisse, crs= "EPSG:2154")
mnt <- st_crop(ras,severaisse)
severaisse
st_crs(severaisse, crs= "EPSG:2154")
st_crs(severaisse, crs= "EPSG:2154")
st_transform(severaisse, crs= "EPSG:2154")
mnt <- st_crop(ras,severaisse)
st_crs(severaisse, crs= "EPSG:2154")
st_crs(severaisse) "EPSG:2154")
st_crs(severaisse)= "EPSG:2154"
st_transform(severaisse, crs= "EPSG:2154")
st_crs(severaisse)= "EPSG:2154"
mnt <- st_crop(ras,severaisse)
plot(mnt)
write_stars(mnt,"mnt_severaisse.tif")
plot(mnt)
plot(mnt)
mnt <- st_crop(ras,severaisse)
plot(mnt)
severaisse
st_crs(severaisse)= "EPSG:2154"
mnt <- st_crop(ras,severaisse)
plot(mnt)
ras,severaisse
ras
severaisse
plot(mnt)
ras
# Création du raster virtuel Drac ----
setwd("C:/Users/thier/Downloads/mnt_63")
c <- "C:/Users/thier/Downloads/mnt_63"
v <- "C:/Users/thier/Downloads/new.vrt" # name of virtual raster
ras_lst <- list.files(c, full.names = T, pattern = ".asc$", recursive=T) # sélection de toutes les dalles
head(ras_lst)
terra::vrt(ras_lst, v, overwrite = T) # création du raster virtuel
ras <- read_stars(v)
st_crs(ras) = "EPSG:2154"
plot(ras, main = "dep 63")
severaisse <- bv %>% filter(bv$TopoOH == "La Séveraisse du torrent de Navette au Drac")
st_transform(severaisse, crs= "EPSG:2154")
st_crs(severaisse)= "EPSG:2154"
mnt <- st_crop(ras, severaisse)
plot(mnt)
plot(severaisse)
mnt <- st_crop(ras, severaisse)
mnt
write_stars(mnt,"mnt_severaisse.tif")
severaisse
write_sf("severaisse.shp")
severaisse
st_write("severaisse.shp")
severaisse
st_write(severaisse, "severaisse.shp")
severaisse <- st_read("severaisse.shp")
mnt <- st_crop(ras, severaisse)
plot(mnt)
# Packages
library(raster)
library(qgisprocess)
library(raster)
library(terra)
library(stars)
library(sf)
library(mapsf)
library(dplyr)
# Sélection du BV via la GeoJSON ----
setwd("~/OT/GEO/GEO/MASTER/M2/SPATIAL_TREE_P/R/RZINE")
bv <- st_read("BassinVersantTopographique.json")
severaisse <- bv %>% filter(bv$TopoOH == "La Séveraisse du torrent de Navette au Drac")
severaisse
# Création du raster virtuel Drac ----
setwd("C:/Users/thier/Downloads/mnt_63_15")
c <- "C:/Users/thier/Downloads/mnt_63_15"
v <- "C:/Users/thier/Downloads/new.vrt" # name of virtual raster
ras_lst <- list.files(c, full.names = T, pattern = ".asc$", recursive=T) # sélection de toutes les dalles
head(ras_lst)
terra::vrt(ras_lst, v, overwrite = T) # création du raster virtuel
ras <- read_stars(v)
st_crs(ras) = "EPSG:2154"
plot(ras, main = "dep 63")
plot(severaisse, add=T)
st_transform(severaisse, crs= "EPSG:2154")
st_crs(severaisse)= "EPSG:2154"
plot(severaisse, add=T)
severaisse
setwd("~/OT/GEO/GEO/RZINE/GEOMORPHON/VECTEUR/BV")
st_write(severaisse, "severaisse.shp")
severaisse <- raster("severaisse.shp")
severaisse <- st_read("severaisse.shp")
plot(severaisse, add=T)
tarentaine <- bv %>% filter(bv$TopoOH == "La Tarentaine (Trentaine) de sa source au confluent de l'Eau Verte")
plot(tarentaine, add=T)
tarentaine
st_transform(tarentaine, crs= "EPSG:2154")
st_crs(tarentaine)= "EPSG:2154"
plot(tarentaine, add=T)
st_write(tarentaine, "tarentaine.shp")
tarentaine <- st_read("tarentaine.shp")
plot(tarentaine, add=T)
plot(tarentaine)
tarentaine
plot(ras, main = "dep 63")
bv <- st_read("tarentaine.gpkg") # changer nom
plot(tarentaine, add=T)
bv <- st_read("tarentaine.gpkg") # changer nom
plot(bv, add=T)
mnt <- st_crop(ras, bv)
plot(mnt)
write_stars(mnt,"mnt_tarentaine.tif")
mnt <- raster("mnt_tarentaine.tif")
plot(mnt)
## Traitement Geomorphons ----
dem_geomorphons = qgis_run_algorithm("saga:geomorphons", # attention, il faut que l'extension soit active dans QGIS
DEM = mnt,
THRESHOLD = 1,
RADIUS = 5,
METHOD = 1,
GEOMORPHONS = paste0("geomorphon_yvette_5m_LD5",".tif"))
## Traitement Geomorphons ----
dem_geomorphons = qgis_run_algorithm("saga:geomorphons", # attention, il faut que l'extension soit active dans QGIS
DEM = mnt,
THRESHOLD = 1,
RADIUS = 5,
METHOD = 1,
GEOMORPHONS = paste0("geomorphon_tarentaine_5m_LD5",".tif"))
geomorphon <- raster("geomorphon_tarentaine_5m_LD5 .tif")
geomorphon <- raster("geomorphon_tarentaine_5m_LD5.tif")
report_geomorphons = qgis_run_algorithm("native:rasterlayeruniquevaluesreport",
INPUT = geomorphon,
BAND = 1,
OUTPUT_TABLE = paste0("rapport_geomorphon_tarentaine_5m_LD5_",".csv"))
## Traitement Geomorphons ----
dem_geomorphons = qgis_run_algorithm("saga:geomorphons", # attention, il faut que l'extension soit active dans QGIS
DEM = mnt,
THRESHOLD = 1,
RADIUS = 100,
METHOD = 1,
GEOMORPHONS = paste0("geomorphon_tarentaine_5m_LD100",".tif"))
mnt <- raster("mnt_severaisse.tif")
plot(mnt)
mnt <- raster("mnt_severaisse.tif")
plot(mnt)
# Création du raster virtuel Drac ----
setwd("C:/Users/thier/Downloads/mnt_05")
c <- "C:/Users/thier/Downloads/mnt_05"
v <- "C:/Users/thier/Downloads/new.vrt" # name of virtual raster
ras_lst <- list.files(c, full.names = T, pattern = ".asc$", recursive=T) # sélection de toutes les dalles
head(ras_lst)
terra::vrt(ras_lst, v, overwrite = T) # création du raster virtuel
ras <- read_stars(v)
st_crs(ras) = "EPSG:2154"
plot(ras, main = "dep ")05
plot(ras, main = "dep 05"
plot(ras, main = "dep 05")
setwd("~/OT/GEO/GEO/RZINE/GEOMORPHON/VECTEUR/BV")
plot(ras, main = "dep 05")
bv <- st_read("BV_severaisse.gpkg") # changer nom
plot(bv, add=T)
mnt <- st_crop(ras, bv)
plot(mnt)
write_stars(mnt,"mnt_severaisse.tif")
mnt <- raster("mnt_severaisse.tif")
plot(mnt)
plot(mnt, main="Severaisse")
## Traitement Geomorphons ----
dem_geomorphons = qgis_run_algorithm("saga:geomorphons", # attention, il faut que l'extension soit active dans QGIS
DEM = mnt,
THRESHOLD = 1,
RADIUS = 100,
METHOD = 1,
GEOMORPHONS = paste0("geomorphon_severaisse_5m_LD100",".tif"))
geomorphon <- raster("geomorphon_severaisse_5m_LD100.tif")
report_geomorphons = qgis_run_algorithm("native:rasterlayeruniquevaluesreport",
INPUT = geomorphon,
BAND = 1,
OUTPUT_TABLE = paste0("rapport_geomorphon_severaisse_5m_LD100_",".csv"))
library(tmap)
library(colourpicker)
r <- rast("data/geomorphon_riberot_5m_LD100.tif")
r <- rast("data/geomorphon_severaisse_5m_LD100.tif")
r <- rast("geomorphon_severaisse_5m_LD100.tif")
tm_shape(r) +
tm_raster
tm_shape(r) +
tm_raster()
tm_raster(r) +
tm_shape(r)
tm_raster(r) +
tm_shape()
tm_shape(r) +
tm_raster()
tm_raster(r)
tm_shape(r) +
tm_raster()
r <- raster("geomorphon_severaisse_5m_LD100.tif")
tm_shape(r) +
tm_raster()
st_crs(r) = "EPSG:2154"
crs(r) = "EPSG:2154"
tm_shape(r) +
tm_raster()
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Land Cover")
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot")
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass()
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star")
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star", size = 1)
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star", size = 1, position = c("topright"))
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star", size = 1, position = "topright")
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star", size = 1, position = "left")
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star", size = 1, position = "right")
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star", size = 1, position = "right")+
tm_scale_bar()
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star", size = 1, position = "right")+
tm_scale_bar(width = 0.5)
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star", size = 1, position = "right")+
tm_scale_bar(width = 2)
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star", size = 1, position = "right")+
tm_scale_bar(width = 3)
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star", size = 1, position = "right")+
tm_scale_bar(width = 4)
tm_shape(r) +
tm_raster(style= "cat",
labels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star", size = 1, position = "right")+
tm_scale_bar(width = 4, breaks = 2)
tm_shape(r) +
tm_raster(style= "cat",
labels = c("Plan", "Sommet", "Crête", "Haut de versant", "Eperon", "Pente", "Creux de versant", "Bas de versant", "Vallée", "Dépression"),
palette = c("#dcdcdc", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038"),
title="Géomorphons du Ribérot") +
tm_compass(type = "4star", size = 1, position = "right")+
tm_scale_bar(width = 4, breaks = 2)
knitr::opts_chunk$set(echo = TRUE)
library(tmap)
mnt <- raster("mnt_riberot.tif")
plot(mnt)
## Traitement Geomorphons ----
dem_geomorphons = qgis_run_algorithm("saga:geomorphons", # attention, il faut que l'extension soit active dans QGIS
DEM = mnt,
THRESHOLD = 1,
RADIUS = 100,
METHOD = 1,
GEOMORPHONS = paste0("geomorphon_riberot_5m_LD100", ".tif"))
geomorphon <- raster("geomorphon_riberot_5m_LD100.tif")
report_geomorphons = qgis_run_algorithm("native:rasterlayeruniquevaluesreport",
INPUT = geomorphon,
BAND = 1,
OUTPUT_TABLE = paste0("rapport_geomorphon_riberot_5m_LD100", ".csv"))
r <- raster("geomorphon_riberot_5m_LD100.tif")
setwd("~/OT/GEO/GEO/MASTER/M2/SPATIAL_TREE_P/R/fiche_rzine_geomorphon")
library(terra)
r <- raster("data/geomorphon_riberot_5m_LD100.tif")
crs(r) <- "EPSG:2154"
